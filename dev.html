<!-- dev.html -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Developer Paneel - Bingo Beheer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5ff;
      margin: 0;
      padding: 2rem;
    }
    h1 { text-align: center; color: #6c5ce7; }
    .container {
      max-width: 800px; margin: auto;
      background: white; padding: 2rem;
      border-radius: 1rem; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button {
      width: 100%; margin: 0.5rem 0;
      padding: 0.75rem; font-size: 1rem;
      border-radius: 0.5rem; border: 1px solid #ccc;
    }
    button {
      background-color: #6c5ce7;
      color: white; border: none;
      cursor: pointer;
    }
    .account {
      border: 1px solid #ccc;
      padding: 1rem; border-radius: 0.5rem;
      margin-bottom: 1rem;
    }
    .bingo-preview {
      display: grid; grid-template-columns: repeat(5, 1fr);
      gap: 5px; margin-top: 1rem;
    }
    .vakje {
      padding: 0.5rem; background-color: #dfe6e9;
      border-radius: 6px; text-align: center;
      font-weight: bold;
    }
    .grid-inputs {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      margin-bottom: 1rem;
    }
    .grid-inputs input {
      width: 100%;
      padding: 0.5rem;
      text-align: center;
    }
    .notification {
      background-color: #ffeaa7;
      padding: 1rem;
      margin-top: 1rem;
      border-left: 6px solid #fdcb6e;
      border-radius: 0.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Developer Paneel</h1>
  <div class="container">
    <h2>GitHub Token</h2>
    <input type="password" id="githubToken" placeholder="GitHub Personal Access Token" />

    <h2>Account aanmaken</h2>
    <input type="text" id="newUsername" placeholder="Gebruikersnaam" />
    <input type="password" id="newPassword" placeholder="Wachtwoord" />
    <div class="grid-inputs" id="vakInputen"></div>
    <button onclick="createAccount()">Account toevoegen</button>
    <button onclick="renderAccounts()">üîÑ Herlaad kaarten</button>
    <button onclick="uploadToGitHub()">‚¨ÜÔ∏è Upload naar GitHub</button>
    <button onclick="loadFromGitHub()">‚¨áÔ∏è Laad van GitHub</button>

    <h2>Bestaande Accounts</h2>
    <div id="accountList"></div>
    <div id="notifications"></div>
  </div>

  <script>
    const repoOwner = 'Mr-noxius';
    const repoName = 'bingosave';
    const filePath = 'data/bingoUsers.json';

    async function uploadToGitHub() {
      const token = document.getElementById('githubToken').value.trim();
      if (!token) return alert("Voer een GitHub token in.");

      const users = getUsers();
      const progress = getProgress();
      const data = { users, progress };
      const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));

      const getRes = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
        headers: { Authorization: `token ${token}` }
      });
      const getData = await getRes.json();

      const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: `token ${token}`
        },
        body: JSON.stringify({
          message: "Update bingo data",
          content: content,
          sha: getData.sha
        })
      });

      if (res.ok) {
        alert("Gegevens succesvol ge√ºpload naar GitHub!");
      } else {
        alert("Upload mislukt.");
      }
    }

    async function loadFromGitHub() {
      const token = document.getElementById('githubToken').value.trim();
      if (!token) return alert("Voer een GitHub token in.");

      const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
        headers: { Authorization: `token ${token}` }
      });

      if (!res.ok) return alert("Laden mislukt van GitHub.");
      const data = await res.json();
      const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
      saveUsers(content.users);
      saveProgress(content.progress);
      renderAccounts();
    }

    function getUsers() {
      return JSON.parse(localStorage.getItem("bingoUsers") || "[]");
    }

    function saveUsers(users) {
      localStorage.setItem("bingoUsers", JSON.stringify(users));
    }

    function getProgress() {
      return JSON.parse(localStorage.getItem("bingoProgress") || "{}");
    }

    function saveProgress(progress) {
      localStorage.setItem("bingoProgress", JSON.stringify(progress));
    }

    function createAccount() {
      const username = document.getElementById("newUsername").value.trim();
      const password = document.getElementById("newPassword").value;
      const kaart = [];

      for (let i = 0; i < 25; i++) {
        const val = document.getElementById(`vakje${i}`).value.trim();
        kaart.push(val || "");
      }

      if (!username || !password || kaart.some(w => !w)) {
        alert("Vul alle velden in, inclusief 25 vakjes.");
        return;
      }

      const users = getUsers();
      if (users.find(u => u.username === username)) {
        alert("Gebruikersnaam bestaat al.");
        return;
      }

      users.push({ username, password, kaart });
      saveUsers(users);

      const progress = getProgress();
      progress[username] = [];
      saveProgress(progress);

      renderAccounts();
      document.getElementById("newUsername").value = "";
      document.getElementById("newPassword").value = "";
      for (let i = 0; i < 25; i++) {
        document.getElementById(`vakje${i}`).value = "";
      }
    }

    let previousProgress = {};

    function renderAccounts() {
      const users = getUsers();
      const progress = getProgress();
      const list = document.getElementById("accountList");
      list.innerHTML = "";

      users.forEach(user => {
        const div = document.createElement("div");
        div.className = "account";
        div.innerHTML = `<h3>üë§ ${user.username}</h3>`;

        const preview = document.createElement("div");
        preview.className = "bingo-preview";

        user.kaart.forEach((k, index) => {
          const vakje = document.createElement("div");
          vakje.className = "vakje";
          vakje.textContent = k;
          vakje.style.backgroundColor = progress[user.username]?.includes(index) ? "#81ecec" : "#dfe6e9";
          preview.appendChild(vakje);
        });

        div.appendChild(preview);
        list.appendChild(div);

        const old = previousProgress[user.username] || [];
        const nieuw = progress[user.username] || [];
        nieuw.forEach(index => {
          if (!old.includes(index)) {
            showNotification(`${user.username} heeft vakje ${index + 1} afgestreept.`);
          }
        });
        previousProgress[user.username] = [...nieuw];
      });
    }

    function showNotification(message) {
      const notifications = document.getElementById("notifications");
      const div = document.createElement("div");
      div.className = "notification";
      div.textContent = message;
      notifications.appendChild(div);
      setTimeout(() => div.remove(), 4000);
    }

    function generateVakjesInput() {
      const container = document.getElementById("vakInputen");
      for (let i = 0; i < 25; i++) {
        const input = document.createElement("input");
        input.id = `vakje${i}`;
        input.placeholder = `Vakje ${i + 1}`;
        container.appendChild(input);
      }
    }

    function saveDevToken() {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get("token");
      if (token) {
        localStorage.setItem("devToken", token);
        document.getElementById("githubToken").value = token;
      }
    }

    generateVakjesInput();
    saveDevToken();
    renderAccounts();
  </script>
</body>
</html>
